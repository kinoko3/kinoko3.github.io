<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="kinoko3" />


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="kinoko3のblog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="kinoko3のblog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kinoko3のblog">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="kinoko3のblog" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>kinoko3のblog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="https://avatars3.githubusercontent.com/u/10653502?v=4&amp;s=460" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">kinoko3</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="/su897500263@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/kinoko3" title="GitHub"></a>
                            
                                <a class="fa Twitter" href="https://twitter.com/kinokosu3" title="Twitter"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apriori/">Apriori</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Clion/">Clion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/">TCP/IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/liunx/">liunx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scrapy/">scrapy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shadowcsoksR/">shadowcsoksR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uwsgi/">uwsgi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/">zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/七牛云/">七牛云</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据挖掘/">数据挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/树莓派/">树莓派</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爬虫/">爬虫</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">kinoko3</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="https://avatars3.githubusercontent.com/u/10653502?v=4&amp;s=460" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">kinoko3</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="/su897500263@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/kinoko3" title="GitHub"></a>
                            
                                <a class="fa Twitter" target="_blank" href="https://twitter.com/kinokosu3" title="Twitter"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-OpenCV-python的坑" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/03/11/OpenCV-python的坑/" class="article-date">
      <time datetime="2018-03-11T06:51:51.000Z" itemprop="datePublished">2018-03-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/11/OpenCV-python的坑/">OpenCV-python的坑</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="import-cv2的坑"><a href="#import-cv2的坑" class="headerlink" title="import cv2的坑"></a>import cv2的坑</h2><p>需要安装库<code>apt-get install libsm6 libxext6 libxrender1</code></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-liunx全养成①" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/03/11/liunx全养成①/" class="article-date">
      <time datetime="2018-03-11T03:37:21.000Z" itemprop="datePublished">2018-03-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/11/liunx全养成①/">liunx全养成①</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近小组那边找了一大批新人，看起来都是大佬的样子(笑，而且我也要去上课之类的，所有只好重新开一台阿里云的服务器，上个学期那台已经被阿里云释放了，但是我依旧做好了备份，所以应该没有数据丢失(上个学期爬的100M豆瓣数据说丢就丢毫不含糊)，既然重新来，就做一个记录，当一个wiki使用。该文会长期更新。。</p>
<h2 id="服务器前期工作"><a href="#服务器前期工作" class="headerlink" title="服务器前期工作"></a>服务器前期工作</h2><p>因为安全问题和方便的问题，安全登录我们先做好准备，首先做好<code>ssh</code>的登录准备。</p>
<h3 id="生成ssh-key实现无密码登录"><a href="#生成ssh-key实现无密码登录" class="headerlink" title="生成ssh-key实现无密码登录"></a>生成ssh-key实现无密码登录</h3><p>无论是本地还是远程，生成<code>ssh</code>秘钥都是一句命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa -C "your email"</div></pre></td></tr></table></figure>
<p>实现免密码登录只需要把本地<code>.ssh/id_rsa.pub</code>内的秘钥放在远程服务器的<code>.ssh/authorized_keys</code>内即可实现无密码登录。</p>
<h3 id="ssh禁止密码登录"><a href="#ssh禁止密码登录" class="headerlink" title="ssh禁止密码登录"></a>ssh禁止密码登录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/ssh/sshd_config</div></pre></td></tr></table></figure>
<p>禁用密码验证<br>PasswordAuthentication no  //修改为no  133行（最后一行）</p>
<h2 id="更新安装列表"><a href="#更新安装列表" class="headerlink" title="更新安装列表"></a>更新安装列表</h2><p><code>apt-get update</code></p>
<h2 id="布置python环境"><a href="#布置python环境" class="headerlink" title="布置python环境"></a>布置python环境</h2><p>阿里云的Ubuntu系统自带两种稳定版<code>python</code>，一种是<code>Python 2.7.12</code>，一种是<code>Python 3.5.2</code>，但是我都不想用，我就是想用又新又稳定的，比如<code>Python-3.6.4</code>。</p>
<p>我们在python官网上下载编译包<code>wget https://www.python.org/ftp/python/3.6.4/Python-3.6.4.tgz</code></p>
<p>然后解压<code>tar -zxvf Python-3.6.4.tgz</code>。</p>
<blockquote>
<p>我们首先先去编译安装一个zlib，不然安装pip和setuptool会出错<br>我们还需要安装openssl,libssl-dev, libsqlite3-dev<br>然后修改python-3.6.4/Modules/Setup，修改<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> Socket module helper for socket(2)  </div><div class="line">_socket socketmodule.c </div><div class="line">  </div><div class="line"><span class="meta">#</span> Socket module helper for SSL support; you must comment out the other  </div><div class="line"><span class="meta">#</span> socket line above, and possibly edit the SSL variable:  </div><div class="line"><span class="meta">#</span>SSL=/usr/local/ssl  </div><div class="line">_ssl _ssl.c \  </div><div class="line">-DUSE_SSL -I$(SSL)/include -I$(SSL)/include/openssl \  </div><div class="line"><span class="meta">-L$</span>(SSL)/lib -lssl -lcrypto</div></pre></td></tr></table></figure></p>
</blockquote>
<p>！！！！！！！！！！！！！一定要完成上面的注意事项再进行编译安装！！！！！！！！！！！！！！！</p>
<p>我们进入刚刚解压出来的文件夹里，执行3连:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">./configure</div><div class="line">make</div><div class="line">sudo make install</div></pre></td></tr></table></figure>
<h3 id="python虚拟环境virtualenv"><a href="#python虚拟环境virtualenv" class="headerlink" title="python虚拟环境virtualenv"></a>python虚拟环境virtualenv</h3><p><code>pip3 install virtualenv</code></p>
<p>查看<code>Python3.6</code>安装路径:<code>which pyhton3.6</code></p>
<p>创建虚拟环境: <code>virtualenv -p /usr/bin/python3 py3env</code></p>
<p>进入虚拟环境: <code>source py3env/bin/activate</code></p>
<p>退出虚拟环境： <code>deactivate</code></p>
<h2 id="布置ipython-notebook"><a href="#布置ipython-notebook" class="headerlink" title="布置ipython-notebook"></a>布置ipython-notebook</h2><p><code>pip install ipython</code>、<code>pip install jupyter</code>.</p>
<p>启动时候注意端口和地址。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/备忘录/">备忘录</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ubuntu/">Ubuntu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/liunx/">liunx</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Apriori-python复现过程" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/12/10/Apriori-python复现过程/" class="article-date">
      <time datetime="2017-12-10T02:44:16.000Z" itemprop="datePublished">2017-12-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/10/Apriori-python复现过程/">Apriori-python复现过程</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>做数据分析首先需要数据集进行分析，但是我们没有大规模的数据集，可以采用公开的数据集，我们现在做的是一个关联分析的推荐系统，有一个非常出名的电影数据测试集- <a href="https://grouplens.org/datasets/movielens/" target="_blank" rel="external">Moivelens</a>.</p>
<h2 id="选择数据集"><a href="#选择数据集" class="headerlink" title="选择数据集"></a>选择数据集</h2><p>里面有很多的大小不同的数据集，我们选择最大的那个<code>ml-20m</code>。毕竟我们需要大数据才能复现算法。</p>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/data-set/1.jpg" alt="data-set_1"></p>
<h2 id="需要的python库"><a href="#需要的python库" class="headerlink" title="需要的python库"></a>需要的python库</h2><p>因为我们暂时不需要可视化，所以只引入了下面的库：</p>
<ul>
<li><code>pandas</code></li>
</ul>
<p>(写到这里愣了一下，发现只用了一个数据分析库，pandas确实是python的数据分析神器)</p>
<blockquote>
<p>以下全部使用ipython-notebook运行，最后也会放出总的ipynb文件</p>
</blockquote>
<h2 id="数据集整理"><a href="#数据集整理" class="headerlink" title="数据集整理"></a>数据集整理</h2><p>我们读取我们的数据集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Dir = <span class="string">'/Users/su/Desktop/python_project/ml-20m/ratings.csv'</span></div><div class="line">all_ratings = pd.read_csv(Dir)</div></pre></td></tr></table></figure>
<p>然后输出发现数据集是以下的格式：</p>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/data-set/2.jpg" alt="data-set_2"></p>
<p>这样的数据结构在<code>pandas</code>里面叫<code>DataFrame</code>，是一个表格型的数据结构，是左边的数字是行索引(index),还有列索引,我们一般都通过对访问索引来进行列的操作。</p>
<p>最右边的<code>timestamp</code>列是时间戳，相比有<code>:</code>、<code>.</code>的公元纪时更容易存储和使用(只是一串数字)。</p>
<blockquote>
<p>时间戳的介绍<a href="https://zh.wikipedia.org/wiki/UNIX%E6%97%B6%E9%97%B4" target="_blank" rel="external">Unix时间</a></p>
</blockquote>
<p><code>pandas</code>里有时间戳转换的方法<code>to_datatime</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 时间戳转换</span></div><div class="line">all_ratings[<span class="string">'timestamp'</span>] = pd.to_datetime(all_ratings[<span class="string">'timestamp'</span>], unit=<span class="string">'s'</span>)</div></pre></td></tr></table></figure>
<p>将代码运行后，重新将<code>all_ratings</code>输出：</p>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/3.png" alt="all_ratings"></p>
<p>我们发现时间转换公元时间了。</p>
<h2 id="Apriori算法复现"><a href="#Apriori算法复现" class="headerlink" title="Apriori算法复现"></a>Apriori算法复现</h2><p>我们要实现的关联规则是</p>
<ul>
<li>如果一个用户喜欢一个电影，那么他们可能喜欢这部电影。</li>
</ul>
<p>首先我们要知道，用户是否喜欢这一步电影，我们创建一个新的特征<code>favorable</code>,如果用户喜欢这部电影,值为<code>True</code><br>。</p>
<p>代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">all_ratings[<span class="string">"favorable"</span>] = all_ratings[<span class="string">'rating'</span>] &gt; <span class="number">3</span></div></pre></td></tr></table></figure>
<p>我们看一下这个新的特征：</p>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/4.png" alt="favorable"></p>
<p>我们可以先选一部分作为<code>训练集</code>,这样能提高训练速度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 选取前200作为训练集</span></div><div class="line"><span class="comment"># isin是判断矢量化集合的成员资格，返回bool值,以下返回符合资格的成员，返回前200（符合）</span></div><div class="line">ratings = all_ratings[all_ratings[<span class="string">'userId'</span>].isin(range(<span class="number">200</span>))]</div></pre></td></tr></table></figure>
<p>接下来我们新建一个数据集，只包括喜欢电影的数据列。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 返回一个打分全部高于3.0的dataframe</span></div><div class="line">favorable_ratings = ratings[ratings[<span class="string">'favorable'</span>]]</div></pre></td></tr></table></figure>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/5.png" alt="favorable"></p>
<p>我们生成<code>频繁项集</code>的时候会搜索用户喜欢的电影，所以我们需要知道每个用户喜欢的电影。我们按照userid分组，并遍历每个用户看过的每一部电影。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 分组运算 groupby</span></div><div class="line"><span class="comment"># favorable_ratings.groupby("userId")["movieId"]是</span></div><div class="line"><span class="comment"># favorable_ratings['movieId'].groupby(favorable_ratings["userId"])的语法糖</span></div><div class="line"><span class="comment"># k是分组名（用户名），v是数据块（电影id）</span></div><div class="line"><span class="comment"># frozenset是不可变集合</span></div><div class="line">favorable_reviews_by_users = dict((k, frozenset(v.values))</div><div class="line">                                      <span class="keyword">for</span> k, v <span class="keyword">in</span> favorable_ratings.groupby(<span class="string">"userId"</span>)[<span class="string">"movieId"</span>])</div></pre></td></tr></table></figure>
<blockquote>
<p>为什么我们使用<code>frozenset</code>这种不可变集合，因为这种数据结构没有添加和删除操作，分配的内存小，速度很快，比列表(<code>list</code>)、可变集合(<code>set</code>)的速度都快。</p>
</blockquote>
<p>分组运算的原理可以看下图:</p>
<p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-06-17/groupby.png" alt="groupby"></p>
<p>我们做完之后我们看看效果：</p>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/6.png" alt="favorable_reviews_by_users"></p>
<p>现在我们知道每个影迷所喜欢的电影了，然后我们再对每部电影拥有的影迷进行计数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 获取影迷数量求和,对每部电影进行支持度计数（）</span></div><div class="line">num_favorable_by_movie = ratings[[<span class="string">"movieId"</span>, <span class="string">"favorable"</span>]].groupby(<span class="string">"movieId"</span>).sum()</div></pre></td></tr></table></figure>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/7.png" alt="num"></p>
<p>做了前面的准备之后到现在我们开始实现<code>Apriori</code>算法</p>
<p>我们创建一个<code>频繁项集</code>，并且设定<code>最小支持度</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frequent_itemsets = &#123;&#125;  <span class="comment"># 频繁项集</span></div><div class="line">min_support = <span class="number">50</span>    <span class="comment"># 最小支持度</span></div></pre></td></tr></table></figure>
<p>我们开始生成初始的<code>频繁项集</code>，就是<code>1维频繁项集</code>，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frequent_itemsets[<span class="number">1</span>] = dict((frozenset((movie_id,)), row[<span class="string">'favorable'</span>])</div><div class="line">                            <span class="keyword">for</span> movie_id, row <span class="keyword">in</span> num_favorable_by_movie.iterrows()</div><div class="line">                            <span class="keyword">if</span> row[<span class="string">"favorable"</span>] &gt; <span class="number">50</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p>无论是列表推导式和字典推导式在这次复现都会大量出现。</p>
</blockquote>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/8.png" alt="frequent"></p>
<p>我们创建下面的这样一个函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_frequent_itemsets</span><span class="params">(favorable_reviews_by_users, k_1_itemsets, min_support)</span>:</span></div><div class="line">    counts = defaultdict(int)</div><div class="line">    <span class="keyword">for</span> user, reviews <span class="keyword">in</span> favorable_reviews_by_users.items():</div><div class="line">        <span class="keyword">for</span> itemset <span class="keyword">in</span> k_1_itemsets:</div><div class="line">            <span class="keyword">if</span> itemset.issubset(reviews):</div><div class="line">                <span class="keyword">for</span> other_reviewed_movie <span class="keyword">in</span> reviews - itemset:</div><div class="line">                    current_superset = itemset | frozenset((other_reviewed_movie,))）</div><div class="line">                    counts[current_superset] += <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> dict([(itemset, frequency)</div><div class="line">                <span class="keyword">for</span> itemset, frequency <span class="keyword">in</span> counts.items() <span class="keyword">if</span> frequency &gt;= min_support])</div></pre></td></tr></table></figure>
<p>这个函数的功能是传入一个<code>k维的频繁项集</code>，返回一个<code>k+1维的频繁项集</code><br>。</p>
<p>我们一步步对这个函数进行解析，传入3个参数,第一个是之前使用<code>groupby</code>分组运算分组出来的分组,第二个是<code>k维项集</code>,第三个是最小支持度。</p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">counts = defaultdict(int)</div></pre></td></tr></table></figure>
<ul>
<li>生成了一个默认为0的带key的数据字典,values的值具有默认值，keys值自定。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> user, reviews <span class="keyword">in</span> favorable_reviews_by_users.items():</div></pre></td></tr></table></figure>
<ul>
<li>遍历影迷和他们喜欢的电影集合</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> itemset <span class="keyword">in</span> k_1_itemsets:</div><div class="line">    <span class="keyword">if</span> itemset.issubset(reviews):</div></pre></td></tr></table></figure>
<ul>
<li><code>issubset</code>是判断子集函数,判断<code>itemset</code>是否是<code>reviews</code>的子集,如果是则表示用户已经为该电影打分。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> other_reviewed_movie <span class="keyword">in</span> reviews - itemset:</div><div class="line">	 current_superset = itemset | frozenset((other_reviewed_movie,))</div><div class="line">	 counts[current_superset] += <span class="number">1</span></div></pre></td></tr></table></figure>
<ul>
<li>遍历用户打过分却没有出现过在项集里面的电影,然后生成<code>候选项集</code>,<br><code>itemset | frozenset((other_reviewed_movie,))</code>是并集。然后我们进行<code>支持度计数</code>。<code>counts[current_superset] += 1</code>这样的集合出现一次我们就进行一次+1,<code>支持度计数</code><br>。</li>
</ul>
<blockquote>
<p><code>cout</code>这个数据字典上面有介绍,我们使用每个候选项集作为键,支持度为值。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> dict([(itemset, frequency)</div><div class="line">                <span class="keyword">for</span> itemset, frequency <span class="keyword">in</span> counts.items() <span class="keyword">if</span> frequency &gt;= min_support])</div></pre></td></tr></table></figure>
<p>最后在return函数检测<code>频繁程度</code>,返回其中的频繁项集。</p>
<hr>
<p>一个简单的k维for循环:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">20</span>):</div><div class="line">    cur_frequent_itemsets = find_frequent_itemsets(favorable_reviews_by_users,</div><div class="line">                                                   frequent_itemsets[k<span class="number">-1</span>],</div><div class="line">                                                   min_support=min_support)</div><div class="line">    frequent_itemsets[k] = cur_frequent_itemsets</div></pre></td></tr></table></figure>
<p>执行完后我们得到多个维的<code>频繁项集</code>,我们最多只发现了6维的频繁项集。</p>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/9.png" alt="frequent-all"></p>
<p>我们把1维的项集去掉,因为生成关联规则需要两个项目。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">del</span> frequent_itemsets[<span class="number">1</span>]</div></pre></td></tr></table></figure>
<p>创建一个列表存储关联规则</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">candidate_rules = []    <span class="comment"># 关联规则</span></div></pre></td></tr></table></figure>
<p>我们遍历我们生成的<code>频繁项集</code>,第一层for循环把<code>k维项集</code>里面的<code>频繁项集</code>取出，第二层for循环获得每一个项集，第三层遍历项集内数据。</p>
<p>我们使用前提和结论作为规则，结论仅仅只为一个值得推荐的电影。前提为<code>频繁项集</code>内的项目。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> itemset_length, itemset_counts <span class="keyword">in</span> frequent_itemsets.items():</div><div class="line">    <span class="keyword">for</span> itemset <span class="keyword">in</span> itemset_counts.keys():</div><div class="line">        <span class="keyword">for</span> conclusion <span class="keyword">in</span> itemset:</div><div class="line">            premise = itemset - set((conclusion,))</div><div class="line">            candidate_rules.append((premise, conclusion))</div></pre></td></tr></table></figure>
<p>我们输出我们的关联规则看看:</p>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/Apriori/10.png" alt="candidate"></p>
<p>获得关联规则后，我们还需要计算<code>置信度</code>，<code>置信度</code>为规则应验的次数。</p>
<p>首先我们建两个<code>defaultdict</code>字典用来存储规则应验的次数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 存储规则应验的次数</span></div><div class="line">corrent_couts = defaultdict(int)</div><div class="line"><span class="comment"># 不应验的次数</span></div><div class="line">incorrect_couts = defaultdict(int)</div></pre></td></tr></table></figure>
<p>开始计算置信度:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> user, reviews <span class="keyword">in</span> favorable_reviews_by_users.items():</div><div class="line">    <span class="keyword">for</span> candidate_rule <span class="keyword">in</span> candidate_rules:</div><div class="line">        premise, conclusion = candidate_rule</div><div class="line">        <span class="comment"># 判断是否喜欢前提电影</span></div><div class="line">        <span class="keyword">if</span> premise.issubset(reviews):</div><div class="line">            <span class="comment"># 判断是否喜欢结论电影</span></div><div class="line">            <span class="keyword">if</span> conclusion <span class="keyword">in</span> reviews:</div><div class="line">                corrent_couts[candidate_rule] += <span class="number">1</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                incorrect_couts[candidate_rule] += <span class="number">1</span></div><div class="line"><span class="comment"># 置信度计算 P(B|A) = P(AB) / P(A)，每条规则的置信度</span></div><div class="line">rule_confidence = &#123;candidate_rule: corrent_couts[candidate_rule] / float(corrent_couts[candidate_rule] + incorrect_couts[candidate_rule])</div><div class="line">                   <span class="keyword">for</span> candidate_rule <span class="keyword">in</span> candidate_rules&#125;</div></pre></td></tr></table></figure>
<p>然后我们对置信度进行排序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sorted_confidence = sorted(rule_confidence.items(), key=itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p><code>sorted</code>函数使用可以看这里<a href="https://www.cnblogs.com/sysu-blackbear/p/3283993.html" target="_blank" rel="external">sorted函数</a></p>
</blockquote>
<p>Apriori算法的训练生成关联规则暂时到这里就结束了。接下来我们要用剩下来的从数据集作为测试集。</p>
<blockquote>
</blockquote>
<h2 id="评估关联规则"><a href="#评估关联规则" class="headerlink" title="评估关联规则"></a>评估关联规则</h2><p>我们首先将关联规则置信度高的前5位输出:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">5</span>):</div><div class="line">    print(<span class="string">"规则 #&#123;0&#125;"</span>.format(index + <span class="number">1</span>))</div><div class="line">    (premise, conclusion) = sorted_confidence[index][<span class="number">0</span>]</div><div class="line">    print(<span class="string">"关联规则:如果一个人喜欢 &#123;0&#125; 他们应该也会喜欢 &#123;1&#125;"</span>.format(premise, conclusion))</div><div class="line">    print(<span class="string">"- 置信度:&#123;0:.3f&#125;"</span>.format(rule_confidence[(premise, conclusion)]))</div><div class="line">    print(<span class="string">'\n'</span>)</div></pre></td></tr></table></figure>
<p>我们使用之前的关联规则对剩下的数据集进行置信度排序:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">test_dataset = all_ratings[~all_ratings[<span class="string">'userId'</span>].isin(range(<span class="number">200</span>))]</div><div class="line">test_favorable = test_dataset[test_dataset[<span class="string">"favorable"</span>]]</div><div class="line">test_favorable_by_users = dict((k, frozenset(v.values)) <span class="keyword">for</span> k, v <span class="keyword">in</span> test_favorable.groupby(<span class="string">"userId"</span>)[<span class="string">"movieId"</span>])</div><div class="line"></div><div class="line">correct_counts = defaultdict(int)</div><div class="line">incorrect_counts = defaultdict(int)</div><div class="line"></div><div class="line"><span class="keyword">for</span> user, reviews <span class="keyword">in</span> test_favorable_by_users.items():</div><div class="line">    <span class="keyword">for</span> candidate_rule <span class="keyword">in</span> candidate_rules:</div><div class="line">        premise, conclusion = candidate_rule</div><div class="line">        <span class="keyword">if</span> premise.issubset(reviews):</div><div class="line">            <span class="keyword">if</span> conclusion <span class="keyword">in</span> reviews:</div><div class="line">                correct_counts[candidate_rule] += <span class="number">1</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                incorrect_counts[candidate_rule] += <span class="number">1</span></div><div class="line"></div><div class="line">test_confidence = &#123;candidate_rule: correct_counts[candidate_rule] / float(correct_counts[candidate_rule] + incorrect_counts[candidate_rule])</div><div class="line">                   <span class="keyword">for</span> candidate_rule <span class="keyword">in</span> rule_confidence&#125;</div><div class="line"></div><div class="line">sorted_test_confidence = sorted(test_confidence.items(), key=itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<p>获得测试集的置信度后，我们将前5条输出:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">5</span>):</div><div class="line">    print(<span class="string">"规则 #&#123;0&#125;"</span>.format(index + <span class="number">1</span>))</div><div class="line">    (premise, conclusion) = sorted_confidence[index][<span class="number">0</span>]</div><div class="line">    print(<span class="string">"关联规则:如果一个人喜欢 &#123;0&#125; 他们应该也会喜欢 &#123;1&#125;"</span>.format(premise, conclusion))</div><div class="line">    print(<span class="string">" - 训练集 置信度: &#123;0:.3f&#125;"</span>.format(rule_confidence.get((premise, conclusion), <span class="number">-1</span>)))</div><div class="line">    print(<span class="string">" - 测试集 置信度: &#123;0:.3f&#125;"</span>.format(test_confidence.get((premise, conclusion), <span class="number">-1</span>)))</div><div class="line">    print(<span class="string">""</span>)</div></pre></td></tr></table></figure>
<h2 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h2>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apriori/">Apriori</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据挖掘/">数据挖掘</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-mongodb部署设置" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/19/mongodb部署设置/" class="article-date">
      <time datetime="2017-11-19T12:27:08.000Z" itemprop="datePublished">2017-11-19</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/19/mongodb部署设置/">mongodb一些部署设置</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近也要布置一个爬虫项目到云端，之前一直都在本地测试，这次部署也暴露了很多问题，就记一下。</p>
<h2 id="mongodb部署"><a href="#mongodb部署" class="headerlink" title="mongodb部署"></a>mongodb部署</h2><h3 id="mongodb后台运行"><a href="#mongodb后台运行" class="headerlink" title="mongodb后台运行"></a>mongodb后台运行</h3><p>我们可以使用配置文件进行运行，带参数<code>-f</code>。后台运行可以在配置文件里设置<code>fork=true</code>。</p>
<p>下面贴出简单的配置文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">dbpath=/data/db/  # 数据库路径</div><div class="line"></div><div class="line">logpath=/data/db/mongodb.conf  #  输出日志路径</div><div class="line"></div><div class="line">logappend=true		# 日志添加</div><div class="line"></div><div class="line">bind_ip = 0.0.0.0   # 设置可以外网访问</div><div class="line"></div><div class="line">port = 27017      # mongodb默认端口</div><div class="line"></div><div class="line">journal=true    </div><div class="line"></div><div class="line">fork=true   # 后台运行</div></pre></td></tr></table></figure>
<h4 id="关闭后台运行"><a href="#关闭后台运行" class="headerlink" title="关闭后台运行"></a>关闭后台运行</h4><p>我们可以使用命令<code>ps -aux | grep mongod</code>，找到mongod的PID，然后使用命令<code>kill -2 PID</code>安全关闭。</p>
<h3 id="mongodb警告解决"><a href="#mongodb警告解决" class="headerlink" title="mongodb警告解决"></a>mongodb警告解决</h3><p>我们使用mongo shell链接mongod会发现有一些警告，比如这个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2015-10-21T09:03:24.256+0800 I CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/enabled is &apos;always&apos;.  </div><div class="line">2015-10-21T09:03:24.256+0800 I CONTROL  [initandlisten] **        We suggest setting it to &apos;never&apos;  </div><div class="line">2015-10-21T09:03:24.256+0800 I CONTROL  [initandlisten]   </div><div class="line">2015-10-21T09:03:24.256+0800 I CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/defrag is &apos;always&apos;.  </div><div class="line">2015-10-21T09:03:24.256+0800 I CONTROL  [initandlisten] **        We suggest setting it to &apos;never&apos;</div></pre></td></tr></table></figure>
<p>查了一下，好像对内存消耗很大的服务都不喜欢它。</p>
<p>我们有几种方法可以关闭，可以这样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled  </div><div class="line">echo never&gt; /sys/kernel/mm/transparent_hugepage/defrag</div></pre></td></tr></table></figure>
<p>还可以永久关闭它,修改/etc/rc.local：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">if test -f /sys/kernel/mm/transparent_hugepage/enabled; then  </div><div class="line">   echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled  </div><div class="line">fi  </div><div class="line">if test -f /sys/kernel/mm/transparent_hugepage/defrag; then  </div><div class="line">   echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag  </div><div class="line">fi</div></pre></td></tr></table></figure>
<p>还有一个问题一直不知道怎么解决，就是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2017-11-19T17:13:57.343+0800 I CONTROL  [initandlisten] ** WARNING: soft rlimits too low. rlimits set to 7857 processes, 65535 files. Number of processes should be at least 32767.5 : 0.5 times number of files.</div></pre></td></tr></table></figure>
<p>明明修改了那个什么limits文件加了mongod 64000什么的都不行。</p>
<h3 id="mongodb用户权限管理"><a href="#mongodb用户权限管理" class="headerlink" title="mongodb用户权限管理"></a>mongodb用户权限管理</h3><p>在mongo shell里命令有：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#</span> 创建用户</div><div class="line"><span class="meta">&gt;</span> db.createUser(&#123;</div><div class="line">	user:"&lt;name&gt;",</div><div class="line">	pwd:"&lt;password&gt;",</div><div class="line">	roles:[</div><div class="line">		role: "&lt;role&gt;",</div><div class="line">		db: "&lt;database&gt;"</div><div class="line">	]</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="meta">#</span> 验证用户</div><div class="line"><span class="meta">&gt;</span> db.auth(&lt;username&gt;,&lt;password&gt;)</div><div class="line"></div><div class="line"><span class="meta">#</span> 修改用户密码</div><div class="line"><span class="meta">&gt;</span> db.changeUserPassword(&lt;username&gt;, &lt;password&gt;)</div><div class="line"></div><div class="line"><span class="meta">#</span> 删除用户</div><div class="line"><span class="meta">&gt;</span> db.dropUser(&lt;username&gt;, &lt;password&gt;)</div><div class="line"></div><div class="line"><span class="meta">#</span> 删除全部用户</div><div class="line"><span class="meta">&gt;</span> db.dropAllUsers()</div><div class="line"></div><div class="line"><span class="meta">#</span> 获取用户</div><div class="line"><span class="meta">&gt;</span> db.getUser(&lt;username&gt;)</div><div class="line"></div><div class="line"><span class="meta">#</span> 获取多个用户</div><div class="line"><span class="meta">&gt;</span> db.getUsers()</div><div class="line"></div><div class="line"><span class="meta">#</span> 更新用户资料</div><div class="line"><span class="meta">&gt;</span> db.revokeRolesFromUser()</div><div class="line"><span class="meta">&gt;</span> db.revokeRolesFromUser( "accountUser01",</div><div class="line">                        [ &#123; role: "read", db: "stock" &#125;, "readWrite" ],</div><div class="line">                        &#123; w: "majority" &#125;</div><div class="line">                      )</div></pre></td></tr></table></figure>
<p>root权限必须在admin数据库里验证。</p>
<h2 id="pymongo里用户验证"><a href="#pymongo里用户验证" class="headerlink" title="pymongo里用户验证"></a>pymongo里用户验证</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">client[<span class="string">'runoob'</span>].authenticate(<span class="string">'scrapy'</span>,<span class="string">'abc'</span>,<span class="string">'runoob'</span>,mechanism=<span class="string">'SCRAM-SHA-1'</span>)</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/备忘录/">备忘录</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/">mongodb</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-scrapy开发备忘录" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/10/scrapy开发备忘录/" class="article-date">
      <time datetime="2017-11-10T14:16:08.000Z" itemprop="datePublished">2017-11-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/scrapy开发备忘录/">scrapy开发备忘录</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近进了一个数据挖掘的小组，又是干爬虫的事，以前使用bs4+requests用的很顺，但是要优化的东西太多了，就打算学习个框架什么的，就看中了scrapy，希望它不错</p>
<hr>
<p>用了一段时间之后，只能感叹，还是轮子好用。</p>
<h2 id="scrapy基础开发"><a href="#scrapy基础开发" class="headerlink" title="scrapy基础开发"></a>scrapy基础开发</h2><h3 id="一个简单的项目"><a href="#一个简单的项目" class="headerlink" title="一个简单的项目"></a>一个简单的项目</h3><p>基础项目格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── __init__.py</div><div class="line">├── items.py</div><div class="line">├── middlewares.py</div><div class="line">├── pipelines.py</div><div class="line">├── run.py</div><div class="line">├── settings.py</div><div class="line">└── spiders</div><div class="line">    ├── __init__.py</div><div class="line">    ├── main_spider.py</div><div class="line">    ├── my_spider.py</div><div class="line">    ├── quotes_spider.py</div><div class="line">    └── test_spider.py</div></pre></td></tr></table></figure>
<p><code>spiders</code>文件夹里存放爬虫文件，<code>settings</code>是配置文件，<code>items</code>是字段文件，<code>run</code>是从文件执行爬虫，<code>middlewares</code>是中间件，<code>piplines</code>用来清理<code>items</code>或者存进数据库。</p>
<h3 id="一个简单的爬虫文件"><a href="#一个简单的爬虫文件" class="headerlink" title="一个简单的爬虫文件"></a>一个简单的爬虫文件</h3><p>我们的文件放在spiders文件夹里，一个简单的爬虫：</p>
<p><code>new_spiders.py</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> scrapy</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSpider</span><span class="params">(scrapy.Spider)</span>:</span></div><div class="line">	name = <span class="string">"test"</span></div><div class="line">    start_urls = [</div><div class="line">        <span class="string">'https://www.bilibili.com/'</span></div><div class="line">    ]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></div><div class="line">    	<span class="keyword">yield</span> &#123;<span class="string">"title"</span>: h3&#125;</div></pre></td></tr></table></figure>
<p><code>name</code>是爬虫的名字，<code>start_urls</code>是爬虫开始爬的第一个页面。一个爬虫一个爬虫类。</p>
<p><code>parse</code>方法是固定的，用来返回数据。</p>
<h3 id="scrapy-shell调试"><a href="#scrapy-shell调试" class="headerlink" title="scrapy shell调试"></a>scrapy shell调试</h3><p>我们使用命令<code>scrapy shell url</code>，就可以进入这个url下的一个控制台</p>
<p>一般我们使用返回的<code>response</code>进行当前网站的分析，使用<code>response.xpath</code>就可以定位元素。</p>
<p>我们能做的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)</div><div class="line">[s]   crawler    &lt;scrapy.crawler.Crawler object at 0x10068c320&gt;</div><div class="line">[s]   item       &#123;&#125;</div><div class="line">[s]   request    &lt;GET https://www.bilibili.com/&gt;</div><div class="line">[s]   response   &lt;200 https://www.bilibili.com/&gt;</div><div class="line">[s]   settings   &lt;scrapy.settings.Settings object at 0x10754eac8&gt;</div><div class="line">[s]   spider     &lt;DefaultSpider &apos;default&apos; at 0x1078eeda0&gt;</div><div class="line">[s] Useful shortcuts:</div><div class="line">[s]   fetch(url[, redirect=True]) Fetch URL and update local objects (by default, redirects are followed)</div><div class="line">[s]   fetch(req)                  Fetch a scrapy.Request and update local objects </div><div class="line">[s]   shelp()           Shell help (print this help)</div><div class="line">[s]   view(response)    View response in a browser</div></pre></td></tr></table></figure>
<h3 id="选择器-Selectors"><a href="#选择器-Selectors" class="headerlink" title="选择器(Selectors)"></a>选择器(Selectors)</h3><p>我们通常使用<code>xpath</code>来解析网页。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">response.xpath(<span class="string">'//title/text()'</span>).extract()</div></pre></td></tr></table></figure>
<p>我们调用<code>extract()</code>方法来获取原文数据，整句返回一个<code>List</code>。</p>
<p>我们还能使用正则表达式，比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">response.xpath(<span class="string">'//title/text()'</span>).re(<span class="string">'\d+'</span>)</div></pre></td></tr></table></figure>
<p>不需要加<code>extract()</code>方法。</p>
<h3 id="Items"><a href="#Items" class="headerlink" title="Items"></a>Items</h3><p><code>scrapy</code>的字段设置在项目里的<code>items.py</code>文件里设置。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> scrapy</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstSpiderItem</span><span class="params">(scrapy.Item)</span>:</span></div><div class="line">    <span class="comment"># define the fields for your item here like:</span></div><div class="line">    title = scrapy.Field()</div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>设置很简单，所有的字段都设置成<code>Field</code>。</p>
<p>使用Items也很简单，我们把字段导入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> ..items <span class="keyword">import</span> DoubanBookStatusItem</div></pre></td></tr></table></figure>
<p>在<code>parse</code>方法（也可以是自己定义的返回数据方法）里可以这样使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">item = DoubanBookStatusItem()</div><div class="line">item[<span class="string">'press'</span>] = response.xpath(<span class="string">'//*[@id="info"]'</span>).re(<span class="string">'(?&lt;=出版社:&lt;/span&gt; ).*?(?=&lt;br&gt;)'</span>)[<span class="number">0</span>]    <span class="comment"># 出版社</span></div></pre></td></tr></table></figure>
<p><code>press</code>为我们定义的字段名。</p>
<blockquote>
<p>有一个需要注意的，我们使用迭代器yield返回的数据全部都是字典格式的。</p>
</blockquote>
<h3 id="piplines"><a href="#piplines" class="headerlink" title="piplines"></a>piplines</h3><blockquote>
<p>功能需要在settings里面设置</p>
</blockquote>
<p>我们使用mongodb保存,直接贴出代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MongoPipline</span><span class="params">(object)</span>:</span></div><div class="line">    collection_name = <span class="string">'scrapy_items'</span>	<span class="comment"># mongodb集合名</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.mongo_server = <span class="string">'localhost'</span></div><div class="line">        self.mongo_db = <span class="string">'runoob'</span></div><div class="line">        self.port = <span class="number">27017</span></div><div class="line">        self.client = <span class="keyword">None</span></div><div class="line">        self.db = <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></div><div class="line">        </div><div class="line">        self.client = pymongo.MongoClient(self.mongo_server, self.port)</div><div class="line">        self.db = self.client[self.mongo_db]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></div><div class="line">        self.client.close()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></div><div class="line">        self.db[self.collection_name].insert_one(dict(item))</div><div class="line">        <span class="keyword">return</span> item</div></pre></td></tr></table></figure>
<p><code>piplines</code>大概能实现下面功能：</p>
<p>定义一个Python类，然后实现方法<code>process_item(self, item, spider)</code>即可，返回一个字典或<code>Item</code>，或者抛出<code>DropItem</code>异常丢弃这个<code>Item</code>。</p>
<p>或者还可以实现下面几个方法：</p>
<ul>
<li><code>open_spider(self, spider)</code> 蜘蛛打开的时执行</li>
<li><code>close_spider(self, spider)</code> 蜘蛛关闭时执行</li>
<li><code>from_crawler(cls, crawler)</code> 可访问核心组件比如配置和信号，并注册钩子函数到Scrapy中。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/备忘录/">备忘录</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scrapy/">scrapy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/爬虫/">爬虫</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python装饰器" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/10/25/python装饰器/" class="article-date">
      <time datetime="2017-10-25T02:01:14.000Z" itemprop="datePublished">2017-10-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/25/python装饰器/">python装饰器</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="装饰器基础"><a href="#装饰器基础" class="headerlink" title="装饰器基础"></a>装饰器基础</h2><h3 id="函数即为对象"><a href="#函数即为对象" class="headerlink" title="函数即为对象"></a>函数即为对象</h3><p>python中的一切都是对象，对象有什么特征呢？比如：</p>
<ul>
<li>你可以把它赋值给一个变量</li>
<li>你可以赋值它</li>
<li>你可以给它添加属性</li>
<li>你可以作为函数参数来传递它</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(ObjectCreator) <span class="comment"># 你可以打印一个类,因为它是一个对象</span></div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">ObjectCreator</span>'&gt;</span></div><div class="line"><span class="class">&gt;&gt;&gt; <span class="title">def</span> <span class="title">echo</span><span class="params">(o)</span>:</span></div><div class="line"><span class="meta">... </span>      print(o)</div><div class="line">...</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>echo(ObjectCreator) <span class="comment"># 你可以把类作为参数传递</span></div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">ObjectCreator</span>'&gt;</span></div><div class="line"><span class="class">&gt;&gt;&gt; <span class="title">print</span><span class="params">(hasattr<span class="params">(ObjectCreator, <span class="string">'new_attribute'</span>)</span>)</span></span></div><div class="line"><span class="class"><span class="title">False</span></span></div><div class="line">&gt;&gt;&gt; ObjectCreator.new_attribute = 'foo' # 可以给一个类添加属性</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(hasattr(ObjectCreator, <span class="string">'new_attribute'</span>))</div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(ObjectCreator.new_attribute)</div><div class="line">foo</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>ObjectCreatorMirror = ObjectCreator <span class="comment"># 可以把类赋值给一个变量</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(ObjectCreatorMirror.new_attribute)</div><div class="line">foo</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(ObjectCreatorMirror())</div><div class="line">&lt;__main__.ObjectCreator object at <span class="number">0x8997b4c</span>&gt;</div></pre></td></tr></table></figure>
<p>函数还能在别的函数里定义，函数还能返回另外一个函数。</p>
<h2 id="实现装饰器"><a href="#实现装饰器" class="headerlink" title="实现装饰器"></a>实现装饰器</h2><h3 id="实现一个最简单的装饰器"><a href="#实现一个最简单的装饰器" class="headerlink" title="实现一个最简单的装饰器"></a>实现一个最简单的装饰器</h3><p>一个小例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 其他函数作为参数</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_decorator</span><span class="params">(func)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">the_wrapper_fuction</span><span class="params">()</span>:</span></div><div class="line">		<span class="comment"># 在原始函数被调用前的代码放在这里</span></div><div class="line">		print(<span class="string">"123"</span>)</div><div class="line">		func()</div><div class="line">	<span class="keyword">return</span> the_wrapper_fuction</div><div class="line"></div><div class="line"><span class="meta">@my_decorator</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></div><div class="line">	print(<span class="string">"main"</span>)</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">123</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>main</div></pre></td></tr></table></figure>
<h3 id="装饰器高级用法"><a href="#装饰器高级用法" class="headerlink" title="装饰器高级用法"></a>装饰器高级用法</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/学习纪录/">学习纪录</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-python特殊方法学习①" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/10/18/python特殊方法学习①/" class="article-date">
      <time datetime="2017-10-18T03:34:39.000Z" itemprop="datePublished">2017-10-18</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/18/python特殊方法学习①/">python特殊方法学习①</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="特殊方法使用"><a href="#特殊方法使用" class="headerlink" title="特殊方法使用"></a>特殊方法使用</h2><h3 id="len的使用"><a href="#len的使用" class="headerlink" title="len的使用"></a><strong>len</strong>的使用</h3><p>比如这样:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrenchDeck</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">()</span>:</span></div><div class="line">		self.__card = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">return</span> len(self.__card)</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>deck = FrenchDeck()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>len(deck)</div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure>
<p>直接获取长度，不用做过多的解释。</p>
<h2 id="列表推导和生成器表达式"><a href="#列表推导和生成器表达式" class="headerlink" title="列表推导和生成器表达式"></a>列表推导和生成器表达式</h2><h3 id="列表推导"><a href="#列表推导" class="headerlink" title="列表推导"></a>列表推导</h3><p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>sym = <span class="string">'$#%&amp;*'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>codes=[]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>codes = [ord(symbol) <span class="keyword">for</span> symbol <span class="keyword">in</span> sym]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>codes</div><div class="line">[<span class="number">36</span>, <span class="number">35</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">42</span>]</div></pre></td></tr></table></figure>
<p>一个标准的列表推导，我们不必担心换行的问题，我们甚至可以这样使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>codes = [ord(symbol, id) <span class="keyword">for</span> symbol <span class="keyword">in</span> sym</div><div class="line">			     <span class="keyword">for</span> id <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">5</span>)]</div></pre></td></tr></table></figure>
<h3 id="生成器推导"><a href="#生成器推导" class="headerlink" title="生成器推导"></a>生成器推导</h3><p>这个和列表推导式的格式很像，仅仅把方括号换成圆括号。</p>
<p>生成器推导可以逐个产生元素，而不是直接产生一个完整的列表。</p>
<p>我们使用生成器表达式计算笛卡尔积</p>
<p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> tshirt <span class="keyword">in</span> (<span class="string">'%s %s'</span> % (c,s) <span class="keyword">for</span> c <span class="keyword">in</span> colors <span class="keyword">for</span> s <span class="keyword">in</span> sizes):</div><div class="line"><span class="meta">... </span>    print(tshirt)</div><div class="line">...</div><div class="line">black S</div><div class="line">black M</div><div class="line">black L</div><div class="line">white S</div><div class="line">white M</div><div class="line">white L</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>列表生成式是直接生成一个完整的列表，而生成器推导则是可以逐个产生元素</p>
<p>一个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> o <span class="keyword">in</span> (ord(symbol) <span class="keyword">for</span> symbol <span class="keyword">in</span> sym):</div><div class="line"><span class="meta">... </span>    print(o)</div><div class="line">...</div><div class="line"><span class="number">36</span></div><div class="line"><span class="number">35</span></div><div class="line"><span class="number">37</span></div><div class="line"><span class="number">38</span></div><div class="line"><span class="number">42</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>[ord(symbol) <span class="keyword">for</span> symbol <span class="keyword">in</span> sym]</div><div class="line">[<span class="number">36</span>, <span class="number">35</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">42</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>type([ord(symbol) <span class="keyword">for</span> symbol <span class="keyword">in</span> sym])</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt;</span></div><div class="line"><span class="class">&gt;&gt;&gt; <span class="title">type</span><span class="params">(ord<span class="params">(symbol)</span> for symbol in sym)</span></span></div><div class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">generator</span>'&gt;</span></div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/学习纪录/">学习纪录</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-shadowsocsR-privoxy-liunx下使用SSR全局代理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/10/18/shadowsocsR-privoxy-liunx下使用SSR全局代理/" class="article-date">
      <time datetime="2017-10-18T01:32:05.000Z" itemprop="datePublished">2017-10-18</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/18/shadowsocsR-privoxy-liunx下使用SSR全局代理/">shadowsocsR+privoxy liunx下使用SSR全局代理</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>因为这段时间要去学校机房做实验，然后学校机房的网络可能经过了过滤，大陆外的ip一律无法访问，我们在机房用的系统是Ubuntu17.04，我直接用手机usb直接分享网络给机器使用（本来我还以为要使用复杂的网络设置，没想到现在的系统这么高级直接插上就可以使用了）。。但是我们还需要在liunx系统上进行外网访问，然后我测试了很多方法，比如以前的ss-Qt5，electron-ssr之类的GUI软件，但是都不行，后来有dalao指点，使用shadowsocksR-libv或者shadowsocksR-Python版加privoxy进行全局代理，然后我想了下，就试试吧，折腾了一晚终于完成了。</p>
<blockquote>
<p>最后的shadowsocksR-libv的版本是2.6.3</p>
</blockquote>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>因为破娃妹子已经把源项目全部rm了，我们需要去shadowsocksR-backup里找到备份<a href="https://github.com/shadowsocksr-backup/shadowsocksr-libev" target="_blank" rel="external">shadowsocksr-libev</a>，然后<code>git clone</code>或者直接下载回到本地。</p>
<p>我们可以来到文档处，因为我们是ubuntu系统我就进入ubuntu的配置</p>
<p>输入命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> cd shadowsocks-libev</div><div class="line"><span class="meta">$</span> sudo apt-get install --no-install-recommends build-essential autoconf libtool libssl-dev \</div><div class="line">    gawk debhelper dh-systemd init-system-helpers pkg-config asciidoc xmlto apg libpcre3-dev</div><div class="line"><span class="meta">$</span> dpkg-buildpackage -b -us -uc -i</div><div class="line"><span class="meta">$</span> cd ..</div><div class="line"><span class="meta">$</span> sudo dpkg -i shadowsocks-libev*.deb</div></pre></td></tr></table></figure>
<p>最后的<code>shadowsocks-libev*.deb</code>是最后打包好的deb包，输入打包出来的文件名。</p>
<p>然后终极大坑来了</p>
<p>我们使用命令<code>ss-local</code>使用代理。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> ss-local -o [obfs混淆协议] -O [protocol协议] -g [obfsparam混淆参数] -s [服务器地址] -p [服务器端口] -l [本地监听端口] -b [本地监听地址] -k [SS密码] -m [加密方式]</div></pre></td></tr></table></figure>
<p>记住所有选项的顺序一定要按照以上顺序输入</p>
<blockquote>
<p>有个巨坑，我在测试的时候发现重启一次电脑之后，ss-local就没有混淆协议的选项了！！！！如果你使用-O、-g,ss-local会报错没有该参数，后来我转移到另外一台ubuntu虚拟机又可以使用了，坑死。。。。推荐如果出现错误，直接把shadowsocksR-libev删除掉，重新安装包。</p>
</blockquote>
<p>然后我们安装<code>privoxy</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> sudo apt-get install privoxy</div></pre></td></tr></table></figure>
<p>安装完成之后，我们进入<code>/etc/orivoxy</code>更改<code>config</code>，把这句注释掉：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span> listen-address localhost:8118</div></pre></td></tr></table></figure>
<p>然后在最后一行加上：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">forward-socks5 / 127.0.0.1:1080 .</div><div class="line">listen-address 127.0.0.1:8118</div></pre></td></tr></table></figure>
<p>记住第一行后面有一个<code>.</code>，我配置的时候没有记得加<code>.</code>，然后一直不行吓死我了。</p>
<p>然后我们配置全局的http proxy, <code>sudo vim /etc/environment</code>，加入下面的代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export http_proxy=http://127.0.0.1:8118</div><div class="line">export https_proxy=http://127.0.0.1:8118</div></pre></td></tr></table></figure>
<p>然后我们重启计算机，重新来一次<code>ss-local</code>连上代理，使用<code>curl www.google.com</code>试试</p>
<p>大功告成。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/学习纪录/">学习纪录</a><a class="article-category-link" href="/categories/学习纪录/备忘录/">备忘录</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/liunx/">liunx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shadowcsoksR/">shadowcsoksR</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-flask-uwsgi-nginx的部署" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/10/11/flask-uwsgi-nginx的部署/" class="article-date">
      <time datetime="2017-10-11T14:39:05.000Z" itemprop="datePublished">2017-10-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/11/flask-uwsgi-nginx的部署/">flask+uwsgi+nginx的部署</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>哇，之前写一个<code>flask</code>项目的时候，一直打算部署，看了不少的教程，最后选择了<code>flask</code>+<code>uwsgi</code>+<code>nginx</code>的搭配，然后在Ubuntu server里尝试上线，但是就是不行，一直报错502，一直找不到问题所在，后来在家里的一台烂liunx笔记本尝试上线（一样是Ubuntu），这已经距离我的<code>flask</code>项目写好过了几个月了，然后一次就成功了，一脸蒙蔽，这个教程并没有太多的对于<code>uwsgi</code>和<code>nginx</code>的性能优化之类的，仅仅保留了最基本的配置。不会对配置做过多的解释，如果想知道配置文件的解释，可以自己谷歌或者百度查看<code>uwsgi</code>和<code>nginx</code>的配置文件解释。仅仅做一个备忘录。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h3><p>nginx配置文件路径在<code>/etc/nginx</code></p>
<p>nginx配置文件如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">server&#123;</div><div class="line">        listen 80;</div><div class="line">        server_name localhost;</div><div class="line">        charset utf-8;</div><div class="line">        keepalive_timeout 0;</div><div class="line">        client_max_body_size 75M;</div><div class="line">        location / &#123;</div><div class="line">                include uwsgi_params;</div><div class="line">                uwsgi_pass unix:/home/su/upload_file-master/demo.sock;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>server_name</code>为服务器地址，这里因为是本地上线，所以填了本地的地址，这里一个很主要的和<code>uwsgi</code>交互的地方在与<code>uwsgi_pass</code>这个配置选项，链接<code>uwsgi</code>的socket地址，生成这个socket的路径会在<code>uwsgi</code>的配置文件里配置。可以看下面的<code>uwsgi</code>配置。</p>
<p>这个文件的名字是<code>nginx.conf</code>，尽量不要修改，我们将这个文件放在<code>/etc/nginx/site-enabled/</code>里，然后修改一下<code>/etc/nginx/nginx.conf</code>里的<code>include /etc/nginx/sites-enabled/*.conf</code>这一项。</p>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/flask-nginx-uwsgi/nginx-conf.png" alt="nginx.conf"></p>
<p>然后我们检查一下<code>nginx</code>的配置文件正确性，输入命令<code>sudo nginx -t</code>，如果显示:</p>
<p><img src="http://ouonrxq3b.bkt.clouddn.com/flask-nginx-uwsgi/nginx-test.png" alt="nginx-config"></p>
<p>就表示<code>nginx</code>配置文件配置正确</p>
<h3 id="uwsgi-配置"><a href="#uwsgi-配置" class="headerlink" title="uwsgi 配置"></a>uwsgi 配置</h3><p>建议将uwsgi配置文件放在项目根目录下，后缀为<code>.ini</code></p>
<p>uwsgi配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[uwsgi]</div><div class="line">processes = 8</div><div class="line"></div><div class="line">wsgi-file = /home/su/upload_file-master/demo.py</div><div class="line"></div><div class="line">socket = /home/su/upload_file-master/demo.sock</div><div class="line"></div><div class="line">chmod-socket = 666</div><div class="line">module = demo</div><div class="line">callable = app</div></pre></td></tr></table></figure>
<p><code>wsgi.file</code>文件为<code>flask</code>的服务器入口，比如哪个文件有像这样的<code>app.run(debug=True, port=9090, host=&quot;0.0.0.0&quot;)</code>（其实就是服务器启动），<code>socket</code>的保存路径就是<code>nginx</code>配置文件中<code>uwsgi_pass</code>的路径，这个路径一定要对。<code>chomd-socket</code>把<code>socket</code>的权限改写成所有人可写可读。</p>
<blockquote>
<p>callable选项为flask中的<code>app = Flask(__name__)</code></p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/备忘录/">备忘录</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask/">flask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/uwsgi/">uwsgi</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-win下的clion配置" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/10/10/win下的clion配置/" class="article-date">
      <time datetime="2017-10-10T10:55:41.000Z" itemprop="datePublished">2017-10-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/10/win下的clion配置/">win下的Clion配置</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="运行环境配置"><a href="#运行环境配置" class="headerlink" title="运行环境配置"></a>运行环境配置</h3><p>我们需要<code>mingw</code>和<code>Cmake</code>，这个是clion需要的运行环境</p>
<h4 id="mingw安装"><a href="#mingw安装" class="headerlink" title="mingw安装"></a>mingw安装</h4><p>百度mingw，然后点击download/installer,就会自动跳转到下载页面，然后安装，点击之后，一路continue，有个安装路径自己选择一下，如果选择其他路径，可以先创建一个空文件夹再选择其安装。</p>
<p>然后会出现下载安装器的界面，安装完成之后继续按continue退出。<br><img src="http://ouonrxq3b.bkt.clouddn.com/Clion-config/mingw_2.png" alt="mingw"></p>
<p>然后会跳转到这个界面<br><img src="http://ouonrxq3b.bkt.clouddn.com/Clion-config/mingw_3.png" alt="mingw"></p>
<p>我们在要安装的选项右键之后点击<code>Make for Intallation</code>，然后选择以下的选项:<br><img src="http://ouonrxq3b.bkt.clouddn.com/Clion-config/mingw_4.png" alt="mingw"></p>
<p>然后安装，在左上的<code>Installation</code>选项卡里选择，<code>Apply Changes</code>,就可以安装成功了</p>
<h4 id="Cmake安装"><a href="#Cmake安装" class="headerlink" title="Cmake安装"></a>Cmake安装</h4><p>我们在官网找到安装页面<a href="https://cmake.org/download/" target="_blank" rel="external">Download</a></p>
<p>找到cmake 3.8.2的下载的地方，(其他的版本clion不认我也不知道为什么)，选择适合自己系统的版本下载，我们是windows，就选择windows的下载好了。</p>
<p>然后一路安装就OK了</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Clion/">Clion</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2018 kinoko3
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>